---
title: "Method conversion"
output: html_document
author: Freddie Heather (freddieheather@gmail.com)
---

```{r}
library(tidyverse)

# Example dataset
m1_data <- read_csv("example_data.csv")

# Converting from method 1 to method 2 (group by rounded total length or standard length)
m1_to_m2 <- \(df, length_measure = "total_length"){
  
  df |> 
    mutate(rounded_measure := round(!!as.symbol(length_measure))) |> 
    group_by(across(-c(total_length, std_length, fish_weight, n_fish))) |> 
    summarise(catch_weight = sum(fish_weight, na.rm = TRUE), 
              n_fish = sum(n_fish, na.rm = TRUE), 
              .groups = "drop") |> 
    mutate(fish_weight = NA, 
           std_length = NA, 
           total_length = NA, 
           method = 2) |> 
    mutate(!!length_measure := rounded_measure) |> 
    select(names(raw_dat)) 
}

# Converting from method 1 to method 3 (Catch groups)
m1_to_m3 <- \(df){
  
  df |> 
    # group_by(spp_name_lt, date_start, area, location) |>
    group_by(across(-c(total_length, std_length, fork_length, fish_weight, n_fish, age, sex_lt))) |>
    summarise(catch_weight_min = min(fish_weight, na.rm = TRUE), 
              catch_weight_max = max(fish_weight, na.rm = TRUE),
              catch_weight     = sum(fish_weight, na.rm = TRUE),
              catch_length_min = min(total_length, na.rm = TRUE),
              catch_length_max = max(total_length, na.rm = TRUE),
              n_fish = sum(n_fish, na.rm = TRUE), 
              .groups = "drop") |> 
    mutate(fish_weight = NA, 
           std_length = NA, 
           total_length = NA, 
           fork_length = NA,
           age = NA, 
           sex_lt = NA, 
           method = 3) |> 
    select(names(raw_dat)) 
}

# Outputs
m1_data
m1_to_m2(m1_data)
m1_to_m3(m1_data)

```

